CREATE TYPE PhoneNumber AS (
    kodKraju INT,
    kodKierunkowy INT,
    numer VARCHAR(20)
);

CREATE TABLE Autor (
    IdAutor INT PRIMARY KEY IDENTITY(1,1),
    Imie VARCHAR(50) NOT NULL,
    Nazwisko VARCHAR(50) NOT NULL,
    Pseudonim VARCHAR(50)
);

CREATE TABLE Recenzja (
    IdRecenzja INT PRIMARY KEY IDENTITY(1,1),
    Ocena INT NOT NULL,
    Tresc VARCHAR(250),
    UserName VARCHAR(100),
    Ukryj BOOLEAN
);

CREATE TABLE Uzytkownicy(
    IdUzytkownika INT PRIMARY KEY IDENTITY(1,1),
    Status VARCHAR(50),
    Login VARCHAR(20),
    Imie VARCHAR(50) NOT NULL,
    Nazwisko VARCHAR(30) NOT NULL,
    haslo VARCHAR(256) NOT NULL,
    Typ VARCHAR(30),
    IndexPW INT,
    Wypozyczenie TEXT,
    SMS TEXT
    Telefon PhoneNumber
);

CREATE TABLE Gatunek(
    IdGatunku INT PRIMARY KEY IDENTITY(1,1),
    PokazUkryj VARCHAR(50)
);


CREATE TABLE Wydawnictwo (
    IdWydawnictwo INT PRIMARY KEY IDENTITY(1,1),
    Nazwa VARCHAR(100)
);

CREATE TABLE Notyfikacja(
    IdNotyfikacja INT PRIMARY KEY IDENTITY(1,1),
    IdPrzedluzenia INT,
    Tresc TEXT,
    TYP VARCHAR(30),
    IdUzytkownika INT,
    FOREIGN KEY (IdUzytkownika) REFERENCES Uzytkownicy(IdUzytkownika)
);

CREATE TABLE Zamowienie(
    IdZamowienia INT PRIMARY KEY IDENTITY(1,1),
    IdEgzempalrz INT NOT NULL,
    IdUzytkownika INT NOT NULL,
    Wypozyczenie VARCHAR(50),
    CzasOdbioru VARCHAR(20),
    Data DATE,
    FOREIGN KEY (IdUzytkownika) REFERENCES Uzytkownicy(IdUzytkownika),
    FOREIGN KEY (IdEgzemplarz) REFERENCES Egzemplarz(IdEgzemplarz)
);

CREATE TABLE Przedluzenie(
    IdPrzedluzenia INT PRIMARY KEY IDENTITY(1,1),
    IdWypozyzenia INT NOT NULL,
    Typ VARCHAR(30),
    CzasPrzedluzenia VARCHAR(50),
    FOREIGN KEY (IdPrzedluzenia) REFERENCES Przedluzenie(IdPrzedluzenia)
);

CREATE TABLE Wypozyczenie(
    IdWypozyczenia INT PRIMARY KEY IDENTITY(1,1),
    IdZamowienia INT,
    IdEgzemplarz INT,
    DzienWypozyczenia INT,
    CzasWypozyczenia VARCHAR(50),
    DataZwrotu VARCHAR(25),
    FOREIGN KEY (IdWypozyczenia) REFERENCES Przedluzenie(IdWypozyczenia)
);


CREATE TABLE Egzemplarz(
    IdEgzemplarz INT PRIMARY KEY IDENTITY(1,1),
    IdKsiazki INT,
    IdBiblioteka INT,
    Status VARCHAR(50),
    Zuzycie INT,
    FOREIGN KEY (IdBiblioteka) REFERENCES Biblioteka(IdBiblioteka),
    FOREIGN KEY (IdKsiazki) REFERENCES Ksiazka(IdKsiazka),
    FOREIGN KEY (IdEgzemplarz) REFERENCES Wypozyczenie(IdEgzemplarz) 
);

CREATE TABLE GodzinyOtwarcia(
    IdGodzinyOtwarcia INT PRIMARY KEY IDENTITY(1,1),
    IdBiblioteka INT NOT NULL,
    DzienTygodnia VARCHAR(30),
    Godziny TIME,
    STATUS VARCHAR(50)
    FOREIGN KEY (IdBiblioteka) REFERENCES Biblioteka(IdBiblioteka)
);

CREATE TABLE Lokalizacja(
    IdLokalizacja INT PRIMARY KEY IDENTITY(1,1),
    Miasto VARCHAR(100),
    Ulica VARCHAR(100),
    KodPocztowy VARCHAR(10),
    Wojewodztwo VARCHAR(100)
);


CREATE TABLE Biblioteka(
    IdBiblioteka INT PRIMARY KEY IDENTITY(1,1),
    IdLokalizacja INT,
    IdGodzinyOtwarcia INT,
    FOREIGN KEY (IdLokalizacja) REFERENCES Lokalizacja(IdLokalizacja),
    FOREIGN KEY (IdGodzinyOtwarcia) REFERENCES GodzinyOtwarcia(IdGodzinyOtwarcia),
);



CREATE TABLE Ksiazka (
    IdKsiazka INT PRIMARY KEY IDENTITY(1,1),
    IdAutor INT NOT NULL,
    IdGatunku INT NOT NULL,
    Opis TEXT,
    IdRecenzja INT,
    RokWydania INT,
    IdWydawnictwo INT,
    status VARCHAR(20),
    IdMagazyn INT,
    FOREIGN KEY (IdAutor) REFERENCES Autor(IdAutor),
    FOREIGN KEY (IdRecenzja) REFERENCES Recenzja(IdRecenzja),
    FOREIGN KEY (IdWydawnictwo) REFERENCES Wydawnictwo(IdWydawnictwo),
    FOREIGN KEY (IdGatunku) REFERENCES Gatunek(IdGatunku) 
);
